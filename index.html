<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap');

    body { font-family: 'Rajdhani', sans-serif; background-color: #020410; color: #cbd5e1; }
    
    /* Custom Scrollbar */
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #4a72d6; border-radius: 2px; }
    
    @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .animate-slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .animate-fade-in { animation: fadeIn 0.3s ease-out; }
    
    /* Sci-Fi Grid Background */
    .bg-cyber-grid {
        background-image: 
            linear-gradient(rgba(18, 16, 99, 0.1) 1px, transparent 1px),
            linear-gradient(90deg, rgba(18, 16, 99, 0.1) 1px, transparent 1px);
        background-size: 40px 40px;
    }

    /* Cyberpunk Shape (Clip Path) */
    .cyber-shape {
        clip-path: polygon(
            15px 0, 100% 0, 
            100% calc(100% - 15px), calc(100% - 15px) 100%, 
            0 100%, 0 15px
        );
    }
    .cyber-shape-inv {
        clip-path: polygon(
            0 0, calc(100% - 15px) 0, 
            100% 15px, 100% 100%, 
            15px 100%, 0 calc(100% - 15px)
        );
    }

    /* --- GLITCH EFFECT CSS --- */
    .glitch {
        position: relative;
        color: white;
        font-weight: 700;
        font-style: italic;
        letter-spacing: 0.1em;
    }
    .glitch::before, .glitch::after {
        content: attr(data-text);
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
    }
    .glitch::before {
        left: 2px;
        text-shadow: -1px 0 #ff00c1;
        clip: rect(44px, 450px, 56px, 0);
        animation: glitch-anim 5s infinite linear alternate-reverse;
    }
    .glitch::after {
        left: -2px;
        text-shadow: -1px 0 #00fff9;
        clip: rect(44px, 450px, 56px, 0);
        animation: glitch-anim 2s infinite linear alternate-reverse;
    }
    @keyframes glitch-anim {
        0% { clip: rect(42px, 9999px, 44px, 0); }
        5% { clip: rect(12px, 9999px, 59px, 0); }
        10% { clip: rect(48px, 9999px, 29px, 0); }
        15% { clip: rect(42px, 9999px, 73px, 0); }
        20% { clip: rect(63px, 9999px, 27px, 0); }
        25% { clip: rect(34px, 9999px, 55px, 0); }
        30% { clip: rect(86px, 9999px, 73px, 0); }
        35% { clip: rect(20px, 9999px, 20px, 0); }
        40% { clip: rect(26px, 9999px, 60px, 0); }
        45% { clip: rect(25px, 9999px, 66px, 0); }
        50% { clip: rect(57px, 9999px, 98px, 0); }
        55% { clip: rect(5px, 9999px, 46px, 0); }
        60% { clip: rect(82px, 9999px, 31px, 0); }
        65% { clip: rect(54px, 9999px, 27px, 0); }
        70% { clip: rect(28px, 9999px, 99px, 0); }
        75% { clip: rect(45px, 9999px, 69px, 0); }
        80% { clip: rect(23px, 9999px, 85px, 0); }
        85% { clip: rect(54px, 9999px, 84px, 0); }
        90% { clip: rect(45px, 9999px, 47px, 0); }
        95% { clip: rect(37px, 9999px, 20px, 0); }
        100% { clip: rect(4px, 9999px, 91px, 0); }
    }

    /* Hide Calendar Icon */
    input[type="date"]::-webkit-calendar-picker-indicator { 
        filter: invert(1); opacity: 0.5; cursor: pointer; width: 12px; height: 12px;
    }
  </style>
</head>
<body class="bg-cyber-grid overflow-x-hidden relative">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // --- Server Helper (อัปเดตเป็น API สำหรับ GitHub Pages) ---
    // *** สำคัญ: นำ URL ของ Web App ที่ได้จาก Google Apps Script มาวางที่นี่ ***
    const API_URL = "https://script.google.com/macros/s/AKfycbxaX0vPt2iD-QnLnPHngchuBUEgECTAAvLS3_nzqNWWmaX4YasTGeHr6NW2xJOUJlP3/exec"; 

    const server = {
      request: async (action, payload = null) => {
        try {
          const response = await fetch(API_URL, {
            method: 'POST',
            // ใช้ text/plain เพื่อเลี่ยงการติด CORS Preflight จากเบราว์เซอร์
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify({ action: action, payload: payload })
          });
          const data = await response.json();
          if (data.error) throw new Error(data.error);
          return data;
        } catch (error) {
          console.error("API Request Error:", error);
          throw error;
        }
      },
      getData: () => server.request('getInitialData'),
      addQueue: (data) => server.request('addQueue', data),
      updateQueue: (data) => server.request('updateQueue', data),
      deleteQueue: (id) => server.request('deleteQueue', id),
      saveSettings: (settings) => server.request('saveSettings', settings),
    };

    // --- Icon Wrapper ---
    const IconWrapper = ({ name, size = 24, className }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          lucide.createIcons({
            root: ref.current,
            nameAttr: 'data-lucide',
            attrs: { class: className, width: size, height: size }
          });
        }
      }, [name, size, className]); 
      const iconKebab = name.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
      return <span ref={ref} className="inline-flex items-center justify-center"><i data-lucide={iconKebab}></i></span>;
    };
    const createIcon = (iconName) => (props) => <IconWrapper name={iconName} {...props} />;

    // Map Icons
    const Plus = createIcon('Plus');
    const Calendar = createIcon('Calendar');
    const User = createIcon('User');
    const CheckCircle = createIcon('CheckCircle');
    const Home = createIcon('Home');
    const List = createIcon('List');
    const X = createIcon('X');
    const CreditCard = createIcon('CreditCard');
    const MessageSquare = createIcon('MessageSquare');
    const Briefcase = createIcon('Briefcase');
    const Edit3 = createIcon('Edit3');
    const Activity = createIcon('Activity');
    const Circle = createIcon('Circle');
    const Play = createIcon('Play');
    const Search = createIcon('Search');
    const History = createIcon('History');
    const Layers = createIcon('Layers');
    const Pencil = createIcon('Pencil');
    const Trash2 = createIcon('Trash2');
    const ShieldCheck = createIcon('ShieldCheck');
    const Lock = createIcon('Lock');
    const Key = createIcon('Key');
    const ChevronLeft = createIcon('ChevronLeft');
    const ChevronRight = createIcon('ChevronRight');
    const CalendarDays = createIcon('CalendarDays');

    // --- Configuration ---
    const ADMIN_PASSWORD = "1234";

    // --- Components ---
    const StatusBadge = ({ type }) => {
      const styles = type === 'urgent' 
        ? 'text-red-400 border-red-500/50 shadow-[0_0_8px_rgba(239,68,68,0.4)]' 
        : 'text-[#4a72d6] border-[#4a72d6]/50 shadow-[0_0_8px_rgba(74,114,214,0.4)]';
      const label = type === 'urgent' ? 'PRIORITY' : 'NORMAL';
      return <span className={`text-[9px] px-2 py-0.5 border font-bold uppercase tracking-widest ${styles}`}>{label}</span>;
    };

    const PaymentBadge = ({ status }) => {
      const config = {
        paid: { color: 'text-emerald-400 border-emerald-500/50', label: 'PAID' },
        deposit: { color: 'text-amber-400 border-amber-500/50', label: 'DEPOSIT' },
        unpaid: { color: 'text-slate-500 border-slate-600/50', label: 'WAITING' },
      };
      const current = config[status] || config.unpaid;
      return <span className={`text-[9px] px-2 py-0.5 border font-bold uppercase tracking-widest ${current.color}`}>{current.label}</span>;
    };

    const QueueCard = ({ data, onStatusChange, onEdit, isAdmin }) => {
      const isDone = data.status === 'done';
      const isDoing = data.status === 'doing';
      return (
        <div className={`relative mb-4 group transition-all duration-300 ${isDone ? 'opacity-40 grayscale' : 'opacity-100'}`}>
           <div className="cyber-shape bg-[#050b1c] border border-slate-800 p-4 hover:border-[#4a72d6] transition-colors relative">
               <div className="flex justify-between items-start mb-2">
                   <div className="flex gap-2 items-center">
                       <span className="text-[#4a72d6] font-bold text-xs">0{data.id % 9 + 1}</span>
                       <StatusBadge type={data.type} />
                       <PaymentBadge status={data.paymentStatus} />
                   </div>
                   {isAdmin && !isDone && (
                    <button onClick={() => onEdit(data)} className="text-slate-600 hover:text-[#4a72d6] transition-colors"><Pencil size={12} /></button>
                   )}
               </div>

               <h3 className={`font-bold text-lg mb-1 tracking-wider uppercase ${isDone ? 'text-slate-500 line-through' : 'text-white'}`}>
                   {data.workType}
               </h3>

               <div className="flex flex-col gap-1 text-slate-400 text-xs mb-1 font-mono border-l-2 border-slate-800 pl-2 ml-1">
                    <div className="flex items-center gap-2">
                        <User size={10} className="text-[#4a72d6]"/>
                        <span className="uppercase text-slate-300">{data.customerName}</span>
                        <span className="text-slate-600">|</span>
                        <span className="text-[9px] uppercase tracking-widest">{data.channel}</span>
                    </div>
                    
                    <div className="flex justify-between items-center mt-1">
                        <div className="flex items-center gap-4">
                            <span className="text-[10px] text-slate-500">START::{data.startDate}</span>
                            <span className="text-[10px] text-red-400 font-bold">DL::{data.deadline}</span>
                        </div>

                        {isAdmin && (
                            <div className="flex gap-2">
                                <button onClick={() => onStatusChange(data.id, 'todo')} className={`transition-all ${data.status === 'todo' ? 'text-white scale-110' : 'text-slate-700 hover:text-slate-500'}`}><Circle size={14} /></button>
                                <button onClick={() => onStatusChange(data.id, 'doing')} className={`transition-all ${isDoing ? 'text-[#4a72d6] scale-110' : 'text-slate-700 hover:text-slate-500'}`}><Play size={14} fill={isDoing ? 'currentColor' : 'transparent'} /></button>
                                <button onClick={() => onStatusChange(data.id, 'done')} className={`transition-all ${isDone ? 'text-emerald-400 scale-110' : 'text-slate-700 hover:text-slate-500'}`}><CheckCircle size={14} fill={isDone ? 'currentColor' : 'transparent'} /></button>
                            </div>
                        )}
                    </div>
               </div>
           </div>
        </div>
      );
    };

    // --- Calendar View Component ---
    const CalendarView = ({ queues, onStatusChange, onEdit, isAdmin }) => {
      const [currentDate, setCurrentDate] = useState(new Date());
      const [selectedDate, setSelectedDate] = useState(new Date()); 

      const getDaysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
      const getFirstDayOfMonth = (date) => new Date(date.getFullYear(), date.getMonth(), 1).getDay();

      const prevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
      const nextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));

      const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
      const daysOfWeek = ["SU", "MO", "TU", "WE", "TH", "FR", "SA"];

      const formatDateStr = (date) => {
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`;
      };

      const renderGrid = () => {
        const totalDays = getDaysInMonth(currentDate);
        const startDay = getFirstDayOfMonth(currentDate);
        const grid = [];

        for (let i = 0; i < startDay; i++) {
          grid.push(<div key={`empty-${i}`} className="min-h-[60px] bg-[#020410] border border-slate-800/30"></div>);
        }

        for (let day = 1; day <= totalDays; day++) {
          const dateObj = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
          const dateStr = formatDateStr(dateObj);
          
          const activeTasks = queues.filter(q => {
             if (!q.startDate || !q.deadline) return false;
             if (q.status === 'done') return false; 
             return dateStr >= q.startDate && dateStr <= q.deadline;
          });

          const isSelected = formatDateStr(selectedDate) === dateStr;
          const isToday = formatDateStr(new Date()) === dateStr;

          grid.push(
            <div 
                key={day} 
                onClick={() => setSelectedDate(dateObj)}
                className={`min-h-[60px] border p-1 relative flex flex-col gap-1 overflow-hidden cursor-pointer transition-all ${isSelected ? 'bg-blue-900/20 border-[#4a72d6]' : 'bg-[#050b1c] border-slate-800 hover:border-slate-600'}`}
            >
              <span className={`text-[9px] font-bold self-end font-mono ${isToday ? 'text-blue-400' : 'text-slate-600'}`}>
                {day < 10 ? `0${day}` : day}
              </span>
              
              <div className="flex flex-col gap-1 w-full">
                {activeTasks.slice(0, 4).map((q, idx) => (
                   <div key={q.id} className={`h-0.5 w-full ${q.type === 'urgent' ? 'bg-red-500' : 'bg-[#4a72d6]'}`}></div>
                ))}
              </div>
            </div>
          );
        }
        return grid;
      };

      const selectedDateStr = formatDateStr(selectedDate);
      const tasksForSelectedDate = queues.filter(q => {
          if (!q.startDate || !q.deadline) return false;
          if (q.status === 'done') return false;
          return selectedDateStr >= q.startDate && selectedDateStr <= q.deadline;
      });

      return (
        <div className="animate-fade-in pb-32">
            <div className="flex justify-between items-center mb-6 px-2 border-b border-slate-800 pb-4">
                <button onClick={prevMonth} className="p-2 text-slate-500 hover:text-[#4a72d6] transition"><ChevronLeft size={20}/></button>
                <div className="text-center">
                    <h2 className="text-2xl font-black text-white uppercase tracking-[0.2em] font-mono">{monthNames[currentDate.getMonth()]}</h2>
                    <span className="text-[10px] font-mono text-slate-500 tracking-widest">{currentDate.getFullYear()} // SYSTEM_CAL</span>
                </div>
                <button onClick={nextMonth} className="p-2 text-slate-500 hover:text-[#4a72d6] transition"><ChevronRight size={20}/></button>
            </div>

            <div className="grid grid-cols-7 gap-px border border-slate-800 mb-6">
                {daysOfWeek.map(d => (
                    <div key={d} className="bg-[#020410] py-2 text-center text-[8px] font-bold text-slate-500 uppercase tracking-widest font-mono">{d}</div>
                ))}
                {renderGrid()}
            </div>

            <div className="space-y-3 animate-slide-up">
                <div className="flex items-center gap-2 mb-2 px-1">
                    <div className="w-1 h-3 bg-[#4a72d6]"></div>
                    <h3 className="text-xs font-bold text-slate-300 uppercase tracking-widest">
                        LOGS :: {selectedDate.toLocaleDateString('en-GB')}
                    </h3>
                </div>

                {tasksForSelectedDate.length > 0 ? (
                    tasksForSelectedDate.map(q => (
                        <QueueCard key={q.id} data={q} onStatusChange={onStatusChange} onEdit={onEdit} isAdmin={isAdmin} />
                    ))
                ) : (
                    <div className="text-center py-8 text-slate-600 bg-[#050b1c] cyber-shape border border-slate-800">
                        <p className="text-[10px] font-mono uppercase tracking-widest">NO_DATA_FOUND</p>
                    </div>
                )}
            </div>
        </div>
      );
    };

    // --- Main App ---
    function App() {
      const [activeTab, setActiveTab] = useState('home');
      const [userRole, setUserRole] = useState('guest'); 
      const [isQueueOpen, setIsQueueOpen] = useState(true);
      const [note, setNote] = useState('INITIALIZING...');
      const [queues, setQueues] = useState([]);
      const [isLoading, setIsLoading] = useState(true);

      const [isModalOpen, setIsModalOpen] = useState(false);
      const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
      const [passwordInput, setPasswordInput] = useState('');
      const [loginError, setLoginError] = useState(false);
      const [nextAvailableDate, setNextAvailableDate] = useState(''); 
      
      const [searchTerm, setSearchTerm] = useState('');
      const [listSubTab, setListSubTab] = useState('active'); 
      const [editingId, setEditingId] = useState(null);

      const [formState, setFormState] = useState({
        type: 'normal', customerName: '', channel: '', workType: '', startDate: '', deadline: '', paymentStatus: 'unpaid'
      });

      const isAdmin = userRole === 'admin';

      useEffect(() => { fetchData(); }, []);

      const fetchData = async () => {
        setIsLoading(true);
        try {
            const data = await server.getData();
            setQueues(data.queues);
            setIsQueueOpen(data.settings.isOpen);
            setNote(data.settings.note);
            setNextAvailableDate(data.settings.nextAvailableDate);
        } catch (error) {
            console.error("Error fetching data", error);
            setNote("Error loading data. Please check API connection.");
        } finally {
            setIsLoading(false);
        }
      };

      const handleStatusChange = async (id, newStatus) => {
        if (!isAdmin) return;
        const oldQueues = [...queues];
        
        const targetQueue = queues.find(q => q.id === id);
        
        setQueues(queues.map(q => q.id === id ? { ...q, status: newStatus } : q));
        
        try { 
            await server.updateQueue({ ...targetQueue, status: newStatus }); 
        } catch(e) { 
            setQueues(oldQueues); 
            alert("Update Failed"); 
        }
      };

      const openAddModal = () => {
        if (!isAdmin) return;
        setEditingId(null);
        setFormState({
            type: 'normal', customerName: '', channel: '', workType: '', startDate: getLocalToday(), deadline: '', paymentStatus: 'unpaid'
        });
        setIsModalOpen(true);
      };

      const openEditModal = (queue) => {
        if (!isAdmin) return;
        setEditingId(queue.id);
        setFormState({ ...queue });
        setIsModalOpen(true);
      };

      const handleDelete = async () => {
        if (editingId && isAdmin) {
            setIsModalOpen(false);
            setIsLoading(true);
            const newData = await server.deleteQueue(editingId);
            setQueues(newData.queues);
            setIsLoading(false);
        }
      };

      const handleSubmit = async () => {
        if (!isAdmin) return;
        setIsModalOpen(false);
        setIsLoading(true);
        try {
            let result;
            if (editingId) {
                result = await server.updateQueue({ ...formState, id: editingId });
            } else {
                result = await server.addQueue({ ...formState, id: Date.now(), status: 'todo' });
            }
            setQueues(result.queues);
        } catch(e) {
            alert("Save Failed: " + (e.message || e));
            console.error(e);
        } finally {
            setIsLoading(false);
        }
      };

      const saveSystemConfig = async (key, value) => {
         if (!isAdmin) return;
         try { await server.saveSettings({ [key]: value }); } catch(e) { console.error("Save setting error", e); }
      };

      const setAndSaveIsQueueOpen = (val) => { setIsQueueOpen(val); saveSystemConfig('isOpen', val); };
      const setAndSaveNote = (val) => { setNote(val); };
      const handleNoteBlur = () => saveSystemConfig('note', note);
      const setAndSaveDate = (val) => { setNextAvailableDate(val); saveSystemConfig('nextAvailableDate', val); };

      const handleToggleRole = () => {
        if (isAdmin) { setUserRole('guest'); } else { setIsLoginModalOpen(true); setLoginError(false); setPasswordInput(''); }
      };

      const attemptLogin = () => {
        if (passwordInput === ADMIN_PASSWORD) {
          setUserRole('admin'); setIsLoginModalOpen(false); setPasswordInput(''); setLoginError(false);
        } else {
          setLoginError(true); setTimeout(() => setLoginError(false), 2000);
        }
      };

      const formatDateDisplay = (dateString) => {
        if (!dateString) return "N/A";
        try {
            const d = new Date(dateString);
            return d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
        } catch (e) { return dateString; }
      };

      const getLocalToday = () => {
        const d = new Date();
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      };

      const today = getLocalToday();
      
      // --- LOGIC UPDATE: Filter "Current Queue" (Between Start Date and Deadline) ---
      const activeQueues = queues.filter(q => {
        if (q.status === 'done') return false;
        if (!q.startDate) return false;
        
        if (q.deadline) {
            return today >= q.startDate && today <= q.deadline;
        }
        return today >= q.startDate;
      });

      const filteredQueues = queues.filter(q => {
        const matchesSearch = q.customerName.toLowerCase().includes(searchTerm.toLowerCase()) || q.workType.toLowerCase().includes(searchTerm.toLowerCase());
        const matchesTab = listSubTab === 'active' ? q.status !== 'done' : q.status === 'done';
        return matchesSearch && matchesTab;
      });

      return (
        <div className="min-h-screen font-sans pb-32 max-w-md mx-auto relative shadow-2xl text-slate-300 border-x border-slate-900/50">
          
          {/* --- Blue Glow --- */}
          <div className="fixed top-0 left-1/2 -translate-x-1/2 w-full h-[300px] bg-[#4a72d6]/5 rounded-full blur-[100px] -z-10 pointer-events-none"></div>

          {/* ... HEADER ... */}
          <div className="sticky top-0 z-20 px-6 py-6 flex justify-between items-center bg-[#020410]/90 backdrop-blur-md border-b border-slate-900">
            <div className="flex flex-col">
               {/* --- GLITCH EFFECT HEADER --- */}
               <h1 className="text-3xl glitch" data-text="KOSAME">KOSAME</h1>
               <div className="flex items-center gap-2 mt-1">
                   <div className="w-8 h-0.5 bg-[#4a72d6]"></div>
                   <span className="text-[10px] text-[#4a72d6] tracking-[0.3em]">CHECK QUEUE</span>
               </div>
            </div>
            <div className="flex gap-2">
              <button onClick={handleToggleRole} className={`w-10 h-10 border cyber-shape flex items-center justify-center transition-all active:scale-95 ${isAdmin ? 'border-[#4a72d6] text-[#4a72d6] shadow-[0_0_10px_rgba(74,114,214,0.3)]' : 'border-slate-800 text-slate-600'}`}>
                  {isAdmin ? <ShieldCheck size={18} /> : <Lock size={18} />}
              </button>
              {isAdmin && (
                <button onClick={openAddModal} className="w-10 h-10 border border-slate-800 cyber-shape flex items-center justify-center text-slate-400 hover:text-white hover:border-white transition-all active:scale-95"><Plus size={20} /></button>
              )}
            </div>
          </div>

          <div className="p-5 space-y-6">
            {isLoading && (
               <div className="fixed inset-0 z-50 flex items-center justify-center bg-[#020410]/90 backdrop-blur-sm">
                  <div className="flex flex-col items-center gap-2">
                    <span className="text-xs tracking-widest text-[#4a72d6] animate-pulse">LOADING_PROTOCOL...</span>
                  </div>
               </div>
            )}

            {activeTab === 'home' && (
                <>
                    {/* Status Card */}
                    <div className={`p-6 relative overflow-hidden cyber-shape border transition-all ${isQueueOpen ? 'border-[#4a72d6]/50 bg-gradient-to-r from-[#050b1c] to-[#0a1129]' : 'border-red-900/50 bg-[#050b1c]'}`}>
                        
                        <div className="flex justify-between items-start mb-4 relative z-10">
                            <div className="flex-1">
                                <div className="flex items-center gap-2 mb-1">
                                    <div className={`w-1.5 h-1.5 rounded-full ${isQueueOpen ? 'bg-emerald-400 shadow-[0_0_8px_#34d399]' : 'bg-red-500 shadow-[0_0_8px_#ef4444]'}`}></div>
                                    <p className="text-slate-500 text-[9px] font-bold uppercase tracking-widest">SYSTEM STATUS</p>
                                </div>
                                <h2 className="text-3xl font-bold italic text-white tracking-widest">{isQueueOpen ? 'ONLINE' : 'OFFLINE'}</h2>
                            </div>
                            {isAdmin && (
                              <button onClick={() => setAndSaveIsQueueOpen(!isQueueOpen)} className="border border-slate-700 bg-slate-900 px-3 py-1 text-[9px] font-bold text-slate-300 uppercase tracking-wider hover:bg-slate-800 transition-all cyber-shape">{isQueueOpen ? 'SHUTDOWN' : 'BOOT'}</button>
                            )}
                        </div>

                        <div className="relative mb-4">
                             <textarea readOnly={!isAdmin} className={`w-full text-xs text-slate-400 bg-black/40 border border-slate-800 p-3 font-mono leading-relaxed ${isAdmin ? 'focus:border-[#4a72d6] focus:outline-none' : 'resize-none'}`} rows={note ? Math.max(2, note.split('\n').length) : 2} value={note} onChange={(e) => isAdmin && setAndSaveNote(e.target.value)} onBlur={handleNoteBlur} />
                        </div>
                        
                        {/* Next Slot */}
                        <div className="flex items-center gap-3 bg-black/40 border-l-2 border-[#4a72d6] p-2 px-3">
                              <div className="text-[#4a72d6]"><Calendar size={16}/></div>
                              <div className="flex flex-col flex-1">
                                  <span className="text-[8px] text-slate-500 uppercase tracking-widest">NEXT AVAILABLE SLOT</span>
                                  {isAdmin ? (
                                    <input type="date" className="bg-transparent border-none outline-none font-bold tracking-widest text-white w-full [color-scheme:dark] cursor-pointer text-sm" value={nextAvailableDate} onChange={(e) => setAndSaveDate(e.target.value)} />
                                  ) : (
                                    <span className="font-bold tracking-widest text-white text-sm">{formatDateDisplay(nextAvailableDate)}</span>
                                  )}
                              </div>
                        </div>
                    </div>
                    
                    <div className="animate-fade-in">
                        <div className="flex justify-between items-center mb-4 px-1 border-b border-slate-900 pb-2">
                            <h3 className="font-bold text-white text-sm uppercase tracking-[0.2em] italic flex items-center gap-2">
                                <span className="text-[#4a72d6]">01</span> CURRENT QUEUE
                            </h3>
                            <span className="text-[10px] text-slate-600 font-mono">[{activeQueues.length}]</span>
                        </div>
                        {activeQueues.length > 0 ? (
                            activeQueues.map(q => <QueueCard key={q.id} data={q} onStatusChange={handleStatusChange} onEdit={openEditModal} isAdmin={isAdmin} />)
                        ) : (
                            <div className="text-center py-12 text-slate-700 bg-[#050b1c] border border-slate-900 cyber-shape">
                                <p className="text-[10px] uppercase tracking-widest">NO TASKS FOR TODAY</p>
                            </div>
                        )}
                    </div>
                </>
            )}

            {activeTab === 'list' && (
                <div className="animate-fade-in space-y-5">
                    <div className="relative group">
                        <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-600"><Search size={16} /></div>
                        <input type="text" placeholder="SEARCH DATABASE..." className="w-full bg-[#050b1c] border border-slate-800 py-3 pl-12 pr-4 text-sm text-white placeholder-slate-700 focus:outline-none focus:border-[#4a72d6] transition-all font-mono uppercase cyber-shape" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                    </div>
                    
                    <div className="flex p-1 bg-[#050b1c] border border-slate-800 cyber-shape">
                        <button onClick={() => setListSubTab('active')} className={`flex-1 py-2 text-[10px] font-bold uppercase tracking-widest transition-all ${listSubTab === 'active' ? 'bg-[#4a72d6] text-white' : 'text-slate-600 hover:text-white'}`}>ACTIVE</button>
                        <button onClick={() => setListSubTab('history')} className={`flex-1 py-2 text-[10px] font-bold uppercase tracking-widest transition-all ${listSubTab === 'history' ? 'bg-emerald-900/50 text-emerald-400' : 'text-slate-600 hover:text-white'}`}>HISTORY</button>
                    </div>

                    <div className="space-y-3 pb-24">
                        {filteredQueues.length > 0 ? (
                            filteredQueues.map(q => <QueueCard key={q.id} data={q} onStatusChange={handleStatusChange} onEdit={openEditModal} isAdmin={isAdmin} />)
                        ) : (
                            <div className="text-center py-20 text-slate-700 border border-slate-900 border-dashed">
                                 <p className="text-[10px] uppercase tracking-widest">DATA NOT FOUND</p>
                            </div>
                        )}
                    </div>
                </div>
            )}
            
            {activeTab === 'calendar' && isAdmin && (
                <CalendarView queues={queues} onStatusChange={handleStatusChange} onEdit={openEditModal} isAdmin={isAdmin} />
            )}
          </div>

          {/* Login Modal */}
          {isLoginModalOpen && (
            <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-[#020410]/95 backdrop-blur-md animate-fade-in">
                <div className="bg-[#050b1c] w-full max-w-xs p-8 border border-[#4a72d6] shadow-[0_0_30px_rgba(74,114,214,0.2)] relative cyber-shape">
                    <button onClick={() => setIsLoginModalOpen(false)} className="absolute top-2 right-4 text-slate-600 hover:text-white"><X size={20} /></button>
                    <div className="flex flex-col items-center gap-4 mb-8">
                        <div className="text-[#4a72d6] animate-pulse"><Key size={40} /></div>
                        <div className="text-center">
                            <h2 className="text-xl font-black text-white uppercase tracking-widest italic">ACCESS CONTROL</h2>
                        </div>
                    </div>
                    <div className="space-y-4">
                        <input autoFocus type="password" placeholder="PASSCODE" className="w-full bg-black border border-slate-800 py-3 text-center text-white tracking-[0.5em] focus:border-[#4a72d6] focus:outline-none font-mono" value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && attemptLogin()} />
                        <button onClick={attemptLogin} className="w-full bg-[#4a72d6] hover:bg-[#3a5bb1] text-white font-bold py-3 uppercase tracking-widest transition-all clip-path-polygon">AUTHENTICATE</button>
                        {loginError && <p className="text-[10px] text-red-500 text-center font-bold">ACCESS DENIED</p>}
                    </div>
                </div>
            </div>
          )}

          {/* Add/Edit Modal */}
          {isModalOpen && isAdmin && (
            <div className="fixed inset-0 z-50 flex items-end justify-center sm:items-center p-4 bg-black/80 backdrop-blur-md animate-fade-in">
                <div className="bg-[#050b1c] w-full max-w-sm p-6 shadow-2xl animate-slide-up relative border border-slate-800 cyber-shape">
                    <button onClick={() => setIsModalOpen(false)} className="absolute top-4 right-4 text-slate-500 hover:text-white"><X size={24} /></button>
                    <h2 className="text-lg font-black text-white mb-6 uppercase tracking-[0.2em] italic border-b border-slate-900 pb-2">{editingId ? 'EDIT ENTRY' : 'NEW ENTRY'}</h2>
                    
                    <div className="space-y-4 max-h-[60vh] overflow-y-auto pr-1 custom-scrollbar">
                         <div className="flex bg-black p-1 border border-slate-800">
                            <button className={`flex-1 py-2 text-[10px] font-bold uppercase tracking-widest transition ${formState.type === 'normal' ? 'bg-[#4a72d6] text-white' : 'text-slate-500'}`} onClick={() => setFormState({...formState, type: 'normal'})}>STANDARD</button>
                            <button className={`flex-1 py-2 text-[10px] font-bold uppercase tracking-widest transition ${formState.type === 'urgent' ? 'bg-red-600 text-white' : 'text-slate-500'}`} onClick={() => setFormState({...formState, type: 'urgent'})}>PRIORITY</button>
                        </div>
                        
                        {[
                          { label: 'CLIENT ID', key: 'customerName', icon: User, placeholder: 'NAME' },
                          { label: 'PLATFORM', key: 'channel', icon: MessageSquare, placeholder: 'SOURCE' },
                          { label: 'JOB TYPE', key: 'workType', icon: Briefcase, placeholder: 'TYPE' }
                        ].map((field) => (
                            <div key={field.key}>
                                <label className="text-[9px] font-bold text-[#4a72d6] mb-1 block uppercase tracking-widest">{field.label}</label>
                                <div className="relative group">
                                    <div className="absolute left-3 top-2.5 text-slate-600 group-focus-within:text-[#4a72d6]"><field.icon size={14}/></div>
                                    <input type="text" className="w-full bg-[#020410] border border-slate-800 py-2 pl-9 pr-2 text-sm text-white placeholder-slate-700 focus:outline-none focus:border-[#4a72d6] font-mono uppercase" placeholder={field.placeholder} value={formState[field.key]} onChange={e => setFormState({...formState, [field.key]: e.target.value})} />
                                </div>
                            </div>
                        ))}

                        <div className="grid grid-cols-2 gap-2">
                            <div>
                                <label className="text-[9px] font-bold text-[#4a72d6] mb-1 block uppercase tracking-widest">INIT DATE</label>
                                <input type="date" className="w-full bg-[#020410] border border-slate-800 py-1.5 px-2 text-[10px] text-white focus:outline-none focus:border-[#4a72d6] [color-scheme:dark] font-mono h-9" value={formState.startDate} onChange={e => setFormState({...formState, startDate: e.target.value})} />
                            </div>
                            <div>
                                <label className="text-[9px] font-bold text-[#4a72d6] mb-1 block uppercase tracking-widest">DEADLINE</label>
                                <input type="date" className="w-full bg-[#020410] border border-slate-800 py-1.5 px-2 text-[10px] text-white focus:outline-none focus:border-[#4a72d6] [color-scheme:dark] font-mono h-9" value={formState.deadline} onChange={e => setFormState({...formState, deadline: e.target.value})} />
                            </div>
                        </div>

                         <div>
                            <label className="text-[9px] font-bold text-[#4a72d6] mb-1 block uppercase tracking-widest">PAYMENT</label>
                            <div className="relative">
                                <div className="absolute left-3 top-2.5 text-slate-600"><CreditCard size={14}/></div>
                                <select className="w-full bg-[#020410] border border-slate-800 py-2 pl-9 pr-4 text-sm text-white focus:outline-none focus:border-[#4a72d6] font-mono uppercase appearance-none" value={formState.paymentStatus} onChange={e => setFormState({...formState, paymentStatus: e.target.value})}>
                                    <option value="unpaid">WAITING</option>
                                    <option value="deposit">DEPOSIT</option>
                                    <option value="paid">COMPLETED</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div className="flex gap-3 mt-6 pt-4 border-t border-slate-900">
                        {editingId && (
                            <button onClick={handleDelete} className="flex-1 bg-red-900/20 text-red-500 border border-red-900/50 py-3 flex items-center justify-center gap-2 hover:bg-red-900/40 transition"><Trash2 size={16} /><span className="text-[10px] font-bold uppercase">DELETE</span></button>
                        )}
                        <button onClick={handleSubmit} className="flex-[2] bg-[#4a72d6] hover:bg-[#3a5bb1] text-white font-bold py-3 uppercase tracking-widest text-xs transition shadow-[0_0_15px_rgba(74,114,214,0.3)]">{editingId ? 'UPDATE DATA' : 'AUTHORIZE'}</button>
                    </div>
                </div>
            </div>
          )}

          {/* Bottom Nav */}
          <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-[#020410]/95 backdrop-blur-xl border border-slate-800 shadow-[0_0_20px_rgba(0,0,0,0.8)] px-6 py-3 flex items-center gap-8 z-40 cyber-shape-inv">
             <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'home' ? 'text-[#4a72d6] drop-shadow-[0_0_5px_rgba(74,114,214,0.8)]' : 'text-slate-600 hover:text-white'}`}>
                <Home size={20} />
                <span className="text-[8px] font-bold tracking-widest">HOME</span>
             </button>
             {isAdmin && (
                <button onClick={() => setActiveTab('calendar')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'calendar' ? 'text-[#4a72d6] drop-shadow-[0_0_5px_rgba(74,114,214,0.8)]' : 'text-slate-600 hover:text-white'}`}>
                    <CalendarDays size={20} />
                    <span className="text-[8px] font-bold tracking-widest">PLAN</span>
                </button>
             )}
             <button onClick={() => setActiveTab('list')} className={`flex flex-col items-center gap-1 transition-all ${activeTab === 'list' ? 'text-[#4a72d6] drop-shadow-[0_0_5px_rgba(74,114,214,0.8)]' : 'text-slate-600 hover:text-white'}`}>
                <List size={20} />
                <span className="text-[8px] font-bold tracking-widest">DATA</span>
             </button>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
